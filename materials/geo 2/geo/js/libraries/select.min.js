$.fn.knotSelect=function(){return this.hide(),this.each((function(){var e=$(this);e.next().hasClass("select")||function(e){e.is(":disabled")&&e.parent().addClass("_inactive"),e.after('<div class="current"></div><div class="select_dropdown"><ul></ul></div>');var s=e.siblings(".current").attr("tabindex","0"),t=e.siblings(".select_dropdown"),l=e.find("option"),i=e.find("option:selected"),a=0;l.each((function(){var e=$(this),l=e.data("display");if("placeholder"==e.val())s.html(i.data("display")||i.text()),a++;else{0==a&&(s.html(i.data("display")||i.text()),a++),t.find("ul").append($("<li></li>").attr("data-value",e.val()).attr("data-display",l||null).addClass((e.is(":selected")?" selected":"")+(e.is(":disabled")?" disabled":"")).html(e.text()))}}))}(e)})),$(document).on("click","._select:not(._inactive) .current, .select_dropdown",(function(e){var s=$(this).hasClass("current")?$(this).siblings(".select_dropdown"):$(this);$(".select_dropdown").not(s).removeClass("active _last").siblings(".current").removeClass("active"),s.toggleClass("active").addClass("_last").siblings(".current").toggleClass("active"),s.hasClass("active")?(s.find(".focus").removeClass("focus"),s.find(".selected").addClass("focus"),s.parents("._select").hasClass("_border")&&$(".select_dropdown").slideDown()):(s.focus(),s.parents("._select").hasClass("_border")&&$(".select_dropdown").slideUp())})),$(document).on("click",(function(e){0===$(e.target).closest("._select").length&&($(".select_dropdown, .current").removeClass("active"),$("._select._border .select_dropdown").slideUp())})),$(document).on("click",".select_dropdown li:not(.disabled)",(function(e){var s=$(this),t=s.closest(".select_dropdown");t.find(".selected").removeClass("selected"),s.addClass("selected");var l=s.data("display")||s.text();t.siblings(".current").text(l),t.siblings("select").val(s.data("value")).trigger("change"),s.parents("._select").hasClass("_border")&&t.slideDown()})),$(document).on("mouseenter",".select_dropdown li",(function(e){$(this).addClass("focus").siblings().removeClass("focus")})),$(document).on("keydown","body",(function(e){var s=$(".select_dropdown._last"),t=$(s.find(".focus")||s.find("li.selected"));if($("._select:not(._inactive) .current").is(":focus")){if(32==e.keyCode||13==e.keyCode)return s.hasClass("active")?t.trigger("click"):s.trigger("click"),!1;if(40==e.keyCode){if(s.hasClass("active")){var l=t.nextAll("li:not(.disabled)").first();l.length>0&&(s.find(".focus").removeClass("focus"),l.addClass("focus"),l.position().top>=s.height()/2&&s.find("ul").animate({scrollTop:l.position().top},230))}return!1}if(38==e.keyCode){if(s.hasClass("active")){var i=t.prevAll("li:not(.disabled)").first();i.length>0&&(s.find(".focus").removeClass("focus"),i.addClass("focus"),i.position().top<=s.height()/2&&s.find("ul").animate({scrollTop:i.position().top+i.height()},230))}return!1}27==e.keyCode&&s.hasClass("active")&&s.trigger("click")}9==e.keyCode&&setTimeout((function(){$("._select .current").each((function(){if($(this).is(":focus")){var e=$(this).hasClass("current")?$(this).siblings(".select_dropdown"):$(this);$(".select_dropdown").not(e).removeClass("_last"),e.addClass("_last"),e.hasClass("active")?(e.find(".focus").removeClass("focus"),e.find(".selected").addClass("focus")):e.focus()}else $(".select_dropdown, .current").removeClass("active")}))}),10)})),!1};